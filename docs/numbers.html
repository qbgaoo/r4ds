<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund">
<title>R数据科学 (第二版) - 13&nbsp; 数值</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./strings.html" rel="next">
<link href="./logicals.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">转换</a></li><li class="breadcrumb-item"><a href="./numbers.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">数值</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R数据科学 (第二版)</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/qbgaoo/r4ds-chinese/" title="源代码" class="quarto-navigation-tool px-1" aria-label="源代码"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="切换深色模式"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="切换阅读器模式">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">欢迎语</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">序言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">引言</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">全貌概览</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">数据可视化</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">工作流程：基础</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">数据转换</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">工作流程: 代码风格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">数据整齐</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">工作流程: 脚本和项目</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">数据导入</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">工作流程：获取帮助</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">可视化</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">图层</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">探索性数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">交流</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">转换</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">逻辑向量</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">数值</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">字符串</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">正则表达式</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">因子</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日期和时间</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">缺失值</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">连接</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">导入</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">电子表格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">数据库</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">层次数据</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">网页抓取</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">编程</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">函数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">迭代</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">R基础实用指南</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">交流</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Quarto 格式</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目 录</h2>
   
  <ul>
<li>
<a href="#%E5%BC%95%E8%A8%80" id="toc-引言" class="nav-link active" data-scroll-target="#%E5%BC%95%E8%A8%80"><span class="header-section-number">13.1</span> 引言</a>
  <ul class="collapse">
<li><a href="#%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6" id="toc-必要条件" class="nav-link" data-scroll-target="#%E5%BF%85%E8%A6%81%E6%9D%A1%E4%BB%B6"><span class="header-section-number">13.1.1</span> 必要条件</a></li>
  </ul>
</li>
  <li><a href="#%E6%95%B0%E5%AD%97%E5%8C%96" id="toc-数字化" class="nav-link" data-scroll-target="#%E6%95%B0%E5%AD%97%E5%8C%96"><span class="header-section-number">13.2</span> 数字化</a></li>
  <li>
<a href="#sec-counts" id="toc-sec-counts" class="nav-link" data-scroll-target="#sec-counts"><span class="header-section-number">13.3</span> 计数</a>
  <ul class="collapse">
<li><a href="#%E7%BB%83%E4%B9%A0" id="toc-练习" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0"><span class="header-section-number">13.3.1</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%95%B0%E5%80%BC%E8%BD%AC%E6%8D%A2" id="toc-数值转换" class="nav-link" data-scroll-target="#%E6%95%B0%E5%80%BC%E8%BD%AC%E6%8D%A2"><span class="header-section-number">13.4</span> 数值转换</a>
  <ul class="collapse">
<li><a href="#sec-recycling" id="toc-sec-recycling" class="nav-link" data-scroll-target="#sec-recycling"><span class="header-section-number">13.4.1</span> 算术和循环规则</a></li>
  <li><a href="#%E6%9C%80%E5%B0%8F%E5%80%BC%E5%92%8C%E6%9C%80%E5%A4%A7%E5%80%BC" id="toc-最小值和最大值" class="nav-link" data-scroll-target="#%E6%9C%80%E5%B0%8F%E5%80%BC%E5%92%8C%E6%9C%80%E5%A4%A7%E5%80%BC"><span class="header-section-number">13.4.2</span> 最小值和最大值</a></li>
  <li><a href="#%E6%A8%A1%E8%BF%90%E7%AE%97" id="toc-模运算" class="nav-link" data-scroll-target="#%E6%A8%A1%E8%BF%90%E7%AE%97"><span class="header-section-number">13.4.3</span> 模运算</a></li>
  <li><a href="#%E5%AF%B9%E6%95%B0" id="toc-对数" class="nav-link" data-scroll-target="#%E5%AF%B9%E6%95%B0"><span class="header-section-number">13.4.4</span> 对数</a></li>
  <li><a href="#sec-rounding" id="toc-sec-rounding" class="nav-link" data-scroll-target="#sec-rounding"><span class="header-section-number">13.4.5</span> 四舍五入</a></li>
  <li><a href="#%E5%B0%86%E6%95%B0%E5%AD%97%E5%88%87%E5%88%86%E6%88%90%E5%8C%BA%E9%97%B4" id="toc-将数字切分成区间" class="nav-link" data-scroll-target="#%E5%B0%86%E6%95%B0%E5%AD%97%E5%88%87%E5%88%86%E6%88%90%E5%8C%BA%E9%97%B4"><span class="header-section-number">13.4.6</span> 将数字切分成区间</a></li>
  <li><a href="#sec-cumulative-and-rolling-aggregates" id="toc-sec-cumulative-and-rolling-aggregates" class="nav-link" data-scroll-target="#sec-cumulative-and-rolling-aggregates"><span class="header-section-number">13.4.7</span> 累积和滚动聚合</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-1" id="toc-练习-1" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-1"><span class="header-section-number">13.4.8</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E9%80%9A%E7%94%A8%E8%BD%AC%E6%8D%A2" id="toc-通用转换" class="nav-link" data-scroll-target="#%E9%80%9A%E7%94%A8%E8%BD%AC%E6%8D%A2"><span class="header-section-number">13.5</span> 通用转换</a>
  <ul class="collapse">
<li><a href="#%E7%A7%A9ranks" id="toc-秩ranks" class="nav-link" data-scroll-target="#%E7%A7%A9ranks"><span class="header-section-number">13.5.1</span> 秩（Ranks）</a></li>
  <li><a href="#%E5%81%8F%E7%A7%BB%E9%87%8Foffsets" id="toc-偏移量offsets" class="nav-link" data-scroll-target="#%E5%81%8F%E7%A7%BB%E9%87%8Foffsets"><span class="header-section-number">13.5.2</span> 偏移量（Offsets）</a></li>
  <li><a href="#%E8%BF%9E%E7%BB%AD%E6%A0%87%E8%AF%86%E7%AC%A6" id="toc-连续标识符" class="nav-link" data-scroll-target="#%E8%BF%9E%E7%BB%AD%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="header-section-number">13.5.3</span> 连续标识符</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-2" id="toc-练习-2" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-2"><span class="header-section-number">13.5.4</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%95%B0%E5%80%BC%E6%B1%87%E6%80%BB" id="toc-数值汇总" class="nav-link" data-scroll-target="#%E6%95%B0%E5%80%BC%E6%B1%87%E6%80%BB"><span class="header-section-number">13.6</span> 数值汇总</a>
  <ul class="collapse">
<li><a href="#%E4%B8%AD%E5%BF%83" id="toc-中心" class="nav-link" data-scroll-target="#%E4%B8%AD%E5%BF%83"><span class="header-section-number">13.6.1</span> 中心</a></li>
  <li><a href="#sec-min-max-summary" id="toc-sec-min-max-summary" class="nav-link" data-scroll-target="#sec-min-max-summary"><span class="header-section-number">13.6.2</span> 最小值、最大值和分位数</a></li>
  <li><a href="#%E7%A6%BB%E6%95%A3%E6%80%A7spread" id="toc-离散性spread" class="nav-link" data-scroll-target="#%E7%A6%BB%E6%95%A3%E6%80%A7spread"><span class="header-section-number">13.6.3</span> 离散性（Spread）</a></li>
  <li><a href="#%E5%88%86%E5%B8%83" id="toc-分布" class="nav-link" data-scroll-target="#%E5%88%86%E5%B8%83"><span class="header-section-number">13.6.4</span> 分布</a></li>
  <li><a href="#%E4%BD%8D%E7%BD%AE" id="toc-位置" class="nav-link" data-scroll-target="#%E4%BD%8D%E7%BD%AE"><span class="header-section-number">13.6.5</span> 位置</a></li>
  <li><a href="#%E5%88%A9%E7%94%A8-mutate" id="toc-利用-mutate" class="nav-link" data-scroll-target="#%E5%88%A9%E7%94%A8-mutate"><span class="header-section-number">13.6.6</span> 利用 <code>mutate()</code></a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-3" id="toc-练习-3" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-3"><span class="header-section-number">13.6.7</span> 练习</a></li>
  </ul>
</li>
  <li><a href="#%E5%B0%8F%E7%BB%93" id="toc-小结" class="nav-link" data-scroll-target="#%E5%B0%8F%E7%BB%93"><span class="header-section-number">13.7</span> 小结</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/qbgaoo/r4ds-chinese/edit/main/numbers.qmd" class="toc-action"><i class="bi bi-github"></i>编辑该页面</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">转换</a></li><li class="breadcrumb-item"><a href="./numbers.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">数值</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-numbers" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">数值</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="引言" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="引言">
<span class="header-section-number">13.1</span> 引言</h2>
<p>数值向量是数据科学的基石，你在本书的前面部分已经多次使用过它们。现 在是系统地审视你在R中可以对它们做什么的时候了，确保你能够很好地应对任何涉及数值向量的未来问题。</p>
<p>我们将首先为你提供几个工具，以便在你有字符串时生成数字，然后更详细地介绍<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>函数。然 后，我们将深入探讨与<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>搭配使用的各种数值转换，包括可以应用于其他类型向量的更一般的转换，但通常与数值向量一起使用。最 后，我们将介绍与<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>搭配使用的汇总函数，并向你展示它们也可以与<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>一起使用。</p>
<section id="必要条件" class="level3" data-number="13.1.1"><h3 data-number="13.1.1" class="anchored" data-anchor-id="必要条件">
<span class="header-section-number">13.1.1</span> 必要条件</h3>
<p>本章主要使用来自基础R的函数，这些函数无需加载任何包即可使用。但 我们仍然需要tidyverse，因为我们将在tidyverse的函数（如<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>）内部使用这些基础R函数。和 上一章一样，我们将使用<code>nycflights13</code>数据集的真实示例，以及使用<code><a href="https://rdrr.io/r/base/c.html">c()</a></code>和<code><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble()</a></code>创建的玩具示例。</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="数字化" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="数字化">
<span class="header-section-number">13.2</span> 数字化</h2>
<p>在大多数情况下，你会获得R的数字类型之一的整数或双精度数字。然 而，在某些情况下你可能会遇到以字符串形式出现的数字，可能是因为从列标题中转换得到它们，或者是因为在数据导入过程中出现了某些问题。</p>
<p><code>readr</code>包提供了两个有用的函数来将字符串解析为数字：<code><a href="https://readr.tidyverse.org/reference/parse_atomic.html">parse_double()</a></code>和<code><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number()</a></code>。当 你遇到以字符串形式写入的数字时，可以使用<code><a href="https://readr.tidyverse.org/reference/parse_atomic.html">parse_double()</a></code>。</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1.2"</span>, <span class="st">"5.6"</span>, <span class="st">"1e3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">parse_double</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]    1.2    5.6 1000.0</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>当字符串中包含你想要忽略的非数字文本时，使用<code><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number()</a></code>。这 对于货币数据和百分比特别有用：</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"$1,234"</span>, <span class="st">"USD 3,513"</span>, <span class="st">"59%"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1234 3513   59</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-counts" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="sec-counts">
<span class="header-section-number">13.3</span> 计数</h2>
<p>令人惊讶的是，仅仅通过计数和一些基本的算术运算你就能够完成不少数据科学工作，因此<code>dplyr</code>致力于通过<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>函数使计数尽可能简单。这 个函数非常适合在分析过程中进行快速探索和检查：</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span><span class="co">#&gt;   dest      n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 ABQ     254</span></span>
<span><span class="co">#&gt; 2 ACK     265</span></span>
<span><span class="co">#&gt; 3 ALB     439</span></span>
<span><span class="co">#&gt; 4 ANC       8</span></span>
<span><span class="co">#&gt; 5 ATL   17215</span></span>
<span><span class="co">#&gt; 6 AUS    2439</span></span>
<span><span class="co">#&gt; # ℹ 99 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>尽管在 <a href="workflow-style.html" class="quarto-xref"><span>章节 4</span></a> 给出了建议，但我们通常还是将<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>放在单独的一行，因为它通常在控制台中用于快速检查计算是否按预期工作。</p>
<p>如果你想看到最常见的值，添加 <code>sort = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">dest</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span><span class="co">#&gt;   dest      n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 ORD   17283</span></span>
<span><span class="co">#&gt; 2 ATL   17215</span></span>
<span><span class="co">#&gt; 3 LAX   16174</span></span>
<span><span class="co">#&gt; 4 BOS   15508</span></span>
<span><span class="co">#&gt; 5 MCO   14082</span></span>
<span><span class="co">#&gt; 6 CLT   14064</span></span>
<span><span class="co">#&gt; # ℹ 99 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>请记住，如果希望查看所有值，可以使用<code>|&gt; View()</code>或<code>|&gt; print(n = Inf)</code>。</p>
<p>你可以通过<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>、<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>“手动”执行相同的计算。这 是有用的，因为它允许你同时计算其他汇总统计量：</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 105 × 3</span></span>
<span><span class="co">#&gt;   dest      n delay</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 ABQ     254  4.38</span></span>
<span><span class="co">#&gt; 2 ACK     265  4.85</span></span>
<span><span class="co">#&gt; 3 ALB     439 14.4 </span></span>
<span><span class="co">#&gt; 4 ANC       8 -2.5 </span></span>
<span><span class="co">#&gt; 5 ATL   17215 11.3 </span></span>
<span><span class="co">#&gt; 6 AUS    2439  6.02</span></span>
<span><span class="co">#&gt; # ℹ 99 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>是一个特殊的汇总函数，它不接受任何参数，而是访问关于“当前”组的信息。这 意味着它只能在<code>dplyr</code>的函数内部使用：</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `n()`:</span></span>
<span><span class="co">#&gt; ! Must only be used inside data-masking verbs like `mutate()`,</span></span>
<span><span class="co">#&gt;   `filter()`, and `group_by()`.</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>有几个变体，你可能会觉得它们有用：</p>
<ul>
<li>
<p><code>n_distinct(x)</code>计算一个或多个变量的不同（唯一）值的数量。例 如，我们可以找出哪些目的地有最多的航空公司提供服务：</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>carriers <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n_distinct.html">n_distinct</a></span><span class="op">(</span><span class="va">carrier</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">carriers</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span><span class="co">#&gt;   dest  carriers</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 ATL          7</span></span>
<span><span class="co">#&gt; 2 BOS          7</span></span>
<span><span class="co">#&gt; 3 CLT          7</span></span>
<span><span class="co">#&gt; 4 ORD          7</span></span>
<span><span class="co">#&gt; 5 TPA          7</span></span>
<span><span class="co">#&gt; 6 AUS          6</span></span>
<span><span class="co">#&gt; # ℹ 99 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>加权计数是求和。例 如你可以“计数”每架飞机飞行的英里数：</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>miles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4,044 × 2</span></span>
<span><span class="co">#&gt;   tailnum  miles</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 D942DN    3418</span></span>
<span><span class="co">#&gt; 2 N0EGMQ  250866</span></span>
<span><span class="co">#&gt; 3 N10156  115966</span></span>
<span><span class="co">#&gt; 4 N102UW   25722</span></span>
<span><span class="co">#&gt; 5 N103US   24619</span></span>
<span><span class="co">#&gt; 6 N104UW   25157</span></span>
<span><span class="co">#&gt; # ℹ 4,038 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>加权计数是一个常见的问题，所以<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>函数有一个<code>wt</code>参数来实现同样的功能：</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">tailnum</span>, wt <span class="op">=</span> <span class="va">distance</span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>可以通过结合<code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>和<code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>来计数缺失值。在 <code>flights</code>数据集中，这表示被取消的航班：</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n_cancelled <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; # A tibble: 105 × 2</span></span>
<span><span class="co">#&gt;   dest  n_cancelled</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 ABQ             0</span></span>
<span><span class="co">#&gt; 2 ACK             0</span></span>
<span><span class="co">#&gt; 3 ALB            20</span></span>
<span><span class="co">#&gt; 4 ANC             0</span></span>
<span><span class="co">#&gt; 5 ATL           317</span></span>
<span><span class="co">#&gt; 6 AUS            21</span></span>
<span><span class="co">#&gt; # ℹ 99 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul>
<section id="练习" class="level3" data-number="13.3.1"><h3 data-number="13.3.1" class="anchored" data-anchor-id="练习">
<span class="header-section-number">13.3.1</span> 练习</h3>
<ol type="1">
<li>如何使用<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>来计算给定变量中缺失值的行数？</li>
<li>将以下对<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>的调用扩展为使用<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>、<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>:
<ol type="1">
<li><p><code>flights |&gt; count(dest, sort = TRUE)</code></p></li>
<li><p><code>flights |&gt; count(tailnum, wt = distance)</code></p></li>
</ol>
</li>
</ol></section></section><section id="数值转换" class="level2" data-number="13.4"><h2 data-number="13.4" class="anchored" data-anchor-id="数值转换">
<span class="header-section-number">13.4</span> 数值转换</h2>
<p>转换函数与<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>配合得很好，因为它们的输出长度与输入相同。绝 大多数转换函数已经内置在R的基本包中。列 出所有函数是不切实际的，所以本节将展示一些最有用的。例 如，虽然R提供了你可能梦寐以求的所有三角函数，但我们在这里没有列出它们，因为它们在数据科学中很少需要。</p>
<section id="sec-recycling" class="level3" data-number="13.4.1"><h3 data-number="13.4.1" class="anchored" data-anchor-id="sec-recycling">
<span class="header-section-number">13.4.1</span> 算术和循环规则</h3>
<p>在 <a href="workflow-basics.html" class="quarto-xref"><span>章节 2</span></a> ，我们介绍了算术运算（<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code>）的基础知识，并在此之后多次使用了它们。这 些函数不需要过多的解释，因为它们执行的是你在小学就学过的运算。但 是，我们需要简短地讨论一下循环规则（recycling rules），这些规则决定了当左侧和右侧的长度不同时会发生什么。这 对于像<code>flights |&gt; mutate(air_time = air_time / 60)</code>这样的操作很重要，因为在<code>/</code>的左侧有336,776个数字，而右侧只有一个。</p>
<p>R通过循环或重复较短的向量来处理长度不匹配的情况。如 果我们在数据框之外创建一些向量，就能更容易地看到这个操作过程：</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">/</span> <span class="fl">5</span></span>
<span><span class="co">#&gt; [1] 0.2 0.4 2.0 4.0</span></span>
<span><span class="co"># is shorthand for</span></span>
<span><span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2 0.4 2.0 4.0</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>通常，你只想循环单个数字（即长度为1的向量），但R会循环任何较短的向量。如 果较长的向量不是较短的向量的倍数，R通常会（但不总是）给出警告：</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1  4 10 40</span></span>
<span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in x * c(1, 2, 3): longer object length is not a multiple of shorter</span></span>
<span><span class="co">#&gt; object length</span></span>
<span><span class="co">#&gt; [1]  1  4 30 20</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>这些循环规则也适用于逻辑比较（<code>==</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code>），如果你不小心使用了<code>==</code>而不是<code>%in%</code>，并且数据框的行数不巧地匹配了这些规则，可能会导致一个令人惊讶的结果。例 如，考虑以下代码，它试图找出1月和2月的所有航班：</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 25,977 × 19</span></span>
<span><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1      517            515         2      830            819</span></span>
<span><span class="co">#&gt; 2  2013     1     1      542            540         2      923            850</span></span>
<span><span class="co">#&gt; 3  2013     1     1      554            600        -6      812            837</span></span>
<span><span class="co">#&gt; 4  2013     1     1      555            600        -5      913            854</span></span>
<span><span class="co">#&gt; 5  2013     1     1      557            600        -3      838            846</span></span>
<span><span class="co">#&gt; 6  2013     1     1      558            600        -2      849            851</span></span>
<span><span class="co">#&gt; # ℹ 25,971 more rows</span></span>
<span><span class="co">#&gt; # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, …</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>代码运行无误，但它没有返回你想要的结果。由 于循环规则，它找到了在奇数行出发的1月航班和在偶数行出发的2月航班。不 幸的是，由于<code>flights</code>的行数是偶数所以没有给出警告。</p>
<p>为了防止这种静默失败的情况，tidyverse的大多数函数使用了一种更严格的循环形式，即仅循环单个值。不 幸的是，这在当前情况下或许多其他情况下并不起作用，因为关键的计算是由基础R函数<code>==</code>执行的，而不是<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>。</p>
</section><section id="最小值和最大值" class="level3" data-number="13.4.2"><h3 data-number="13.4.2" class="anchored" data-anchor-id="最小值和最大值">
<span class="header-section-number">13.4.2</span> 最小值和最大值</h3>
<p>算术函数对变量对进行操作。两 个紧密相关的函数是<code><a href="https://rdrr.io/r/base/Extremes.html">pmin()</a></code>和<code><a href="https://rdrr.io/r/base/Extremes.html">pmax()</a></code>，当给定两个或更多变量时，它们将返回每行中的最小或最大值：</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">x</span>, <span class="op">~</span><span class="va">y</span>,</span>
<span>  <span class="fl">1</span>,  <span class="fl">3</span>,</span>
<span>  <span class="fl">5</span>,  <span class="fl">2</span>,</span>
<span>  <span class="fl">7</span>, <span class="cn">NA</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;       x     y   min   max</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     3     1     3</span></span>
<span><span class="co">#&gt; 2     5     2     2     5</span></span>
<span><span class="co">#&gt; 3     7    NA     7     7</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>请注意，这些函数与<code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>和<code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>这样的汇总函数是不同的，后者接受多个观测值并返回一个单一的值。当 发现所有的最小值和所有的最大值都相同时，你可以判断你可能使用了错误的形式。</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;       x     y   min   max</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     3     1     7</span></span>
<span><span class="co">#&gt; 2     5     2     1     7</span></span>
<span><span class="co">#&gt; 3     7    NA     1     7</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="模运算" class="level3" data-number="13.4.3"><h3 data-number="13.4.3" class="anchored" data-anchor-id="模运算">
<span class="header-section-number">13.4.3</span> 模运算</h3>
<p>模运算（modular arithmetic）是你在学习十进制之前所做的数学运算的技术名称，即除法产生一个整数商和一个余数。在 R中，<code>%/%</code>执行整数除法，而<code>%%</code>计算余数。</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">3</span></span>
<span><span class="co">#&gt;  [1] 0 0 1 1 1 2 2 2 3 3</span></span>
<span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">3</span></span>
<span><span class="co">#&gt;  [1] 1 2 0 1 2 0 1 2 0 1</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>模运算对于<code>flights</code>数据集来说很有用，因为我们可以使用它来将<code>sched_dep_time</code>变量分解为<code>hour</code>和<code>minute</code>。</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    hour <span class="op">=</span> <span class="va">sched_dep_time</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">100</span>,</span>
<span>    minute <span class="op">=</span> <span class="va">sched_dep_time</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">100</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 3</span></span>
<span><span class="co">#&gt;   sched_dep_time  hour minute</span></span>
<span><span class="co">#&gt;            &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1            515     5     15</span></span>
<span><span class="co">#&gt; 2            529     5     29</span></span>
<span><span class="co">#&gt; 3            540     5     40</span></span>
<span><span class="co">#&gt; 4            545     5     45</span></span>
<span><span class="co">#&gt; 5            600     6      0</span></span>
<span><span class="co">#&gt; 6            558     5     58</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>我们可以将上述方法与来自 <a href="logicals.html#sec-logical-summaries" class="quarto-xref"><span>小节 12.4</span></a> 的<code>mean(is.na(x))</code>技巧结合起来查看取消航班的比例在一天中的变化情况。结 果如图 <a href="#fig-prop-cancelled" class="quarto-xref">图&nbsp;<span>13.1</span></a> 所示。</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>hour <span class="op">=</span> <span class="va">sched_dep_time</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">100</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>prop_cancelled <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hour</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hour</span>, y <span class="op">=</span> <span class="va">prop_cancelled</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-prop-cancelled" class="quarto-figure quarto-figure-center quarto-float anchored" alt="A line plot showing how proportion of cancelled flights changes over the course of the day. The proportion starts low at around 0.5% at 5am, then steadily increases over the course of the day until peaking at 4% at 7pm. The proportion of cancelled flights then drops rapidly getting down to around 1% by midnight.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-prop-cancelled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="numbers_files/figure-html/fig-prop-cancelled-1.png" class="img-fluid figure-img" alt="A line plot showing how proportion of cancelled flights changes over the course of the day. The proportion starts low at around 0.5% at 5am, then steadily increases over the course of the day until peaking at 4% at 7pm. The proportion of cancelled flights then drops rapidly getting down to around 1% by midnight." width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prop-cancelled-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.1: A line plot with scheduled departure hour on the x-axis, and proportion of cancelled flights on the y-axis. Cancellations seem to accumulate over the course of the day until 8pm, very late flights are much less likely to be cancelled.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="对数" class="level3" data-number="13.4.4"><h3 data-number="13.4.4" class="anchored" data-anchor-id="对数">
<span class="header-section-number">13.4.4</span> 对数</h3>
<p>对数在处理跨越多个数量级的数据以及将指数增长转换为线性增长时是非常有用的转换方法。在 R中，你可以选择三种对数：<code><a href="https://rdrr.io/r/base/Log.html">log()</a></code>（自然对数，底为e）、<code><a href="https://rdrr.io/r/base/Log.html">log2()</a></code>（底为2）和<code><a href="https://rdrr.io/r/base/Log.html">log10()</a></code>（底为10）。我 们推荐使用<code><a href="https://rdrr.io/r/base/Log.html">log2()</a></code>或<code><a href="https://rdrr.io/r/base/Log.html">log10()</a></code>。<code>l</code> <code>og2()</code>易于解释，因为在对数尺度上相差1对应于原始尺度上的加倍，相差-1对应于减半；而<code><a href="https://rdrr.io/r/base/Log.html">log10()</a></code>易于反向转换，因为（例如）3 是 10 的 3 次方，即 1000。<code>l</code> <code>og()</code>的反函数是<code><a href="https://rdrr.io/r/base/Log.html">exp()</a></code>；要计算<code><a href="https://rdrr.io/r/base/Log.html">log2()</a></code>或<code><a href="https://rdrr.io/r/base/Log.html">log10()</a></code>的反函数，你需要使用<code>2^</code>或<code>10^</code>。</p>
</section><section id="sec-rounding" class="level3" data-number="13.4.5"><h3 data-number="13.4.5" class="anchored" data-anchor-id="sec-rounding">
<span class="header-section-number">13.4.5</span> 四舍五入</h3>
<p>使用<code>round(x)</code>将一个数字四舍五入到最接近的整数:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">123.456</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 123</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以使用第二个参数<code>digits</code>来控制四舍五入的精度。<code>r</code> <code>ound(x, digits)</code>会将<code>x</code>四舍五入到最近的 <code>10^-n</code>，所以<code>digits = 2</code>会将<code>x</code>四舍五入到最近的 0.01。这 个定义很有用，因为它意味着<code>round(x, -3)</code>会将<code>x</code>四舍五入到最近的千位，而它确实是这样做的：</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">123.456</span>, <span class="fl">2</span><span class="op">)</span>  <span class="co"># two digits</span></span>
<span><span class="co">#&gt; [1] 123.46</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">123.456</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># one digit</span></span>
<span><span class="co">#&gt; [1] 123.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">123.456</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="co"># round to nearest ten</span></span>
<span><span class="co">#&gt; [1] 120</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">123.456</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span> <span class="co"># round to nearest hundred</span></span>
<span><span class="co">#&gt; [1] 100</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/base/Round.html">round()</a></code>有一个看起来有些奇怪的特性，第一眼看上去这可能会让人吃惊：</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2 2</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/base/Round.html">round()</a></code>使用的是所谓的“向偶数舍入”或“银行家舍入”方法：如果一个数字正好在两个整数之间，那么它会被舍入到偶数整数。这 是一个很好的策略，因为它使得舍入是无偏的：一半的 0.5 被向上舍入，而另一半被向下舍入。</p>
<p><code><a href="https://rdrr.io/r/base/Round.html">round()</a></code>与<code><a href="https://rdrr.io/r/base/Round.html">floor()</a></code>和<code><a href="https://rdrr.io/r/base/Round.html">ceiling()</a></code>相对应。<code>f</code> <code>loor()</code>总是向下舍入，而<code><a href="https://rdrr.io/r/base/Round.html">ceiling()</a></code>总是向上舍入。</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">123.456</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 123</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 124</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>这些函数（<code><a href="https://rdrr.io/r/base/Round.html">floor()</a></code>和<code><a href="https://rdrr.io/r/base/Round.html">ceiling()</a></code>）没有<code>digits</code>参数，所以你可以先将数字缩小比例，然后四舍五入，最后再扩大回原来的比例：</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Round down to nearest two digits</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.01</span></span>
<span><span class="co">#&gt; [1] 123.45</span></span>
<span><span class="co"># Round up to nearest two digits</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.01</span></span>
<span><span class="co">#&gt; [1] 123.46</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果你想要将<code><a href="https://rdrr.io/r/base/Round.html">round()</a></code>舍入到某个数的倍数，你可以使用相同的技巧：</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Round to nearest multiple of 4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fl">4</span></span>
<span><span class="co">#&gt; [1] 124</span></span>
<span></span>
<span><span class="co"># Round to nearest 0.25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.25</span></span>
<span><span class="co">#&gt; [1] 123.5</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="将数字切分成区间" class="level3" data-number="13.4.6"><h3 data-number="13.4.6" class="anchored" data-anchor-id="将数字切分成区间">
<span class="header-section-number">13.4.6</span> 将数字切分成区间</h3>
<p>使用<code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>函数可以将一个数值向量拆分（也称为分箱或分组）成离散的区间：</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] (0,5]   (0,5]   (0,5]   (5,10]  (10,15] (15,20]</span></span>
<span><span class="co">#&gt; Levels: (0,5] (5,10] (10,15] (15,20]</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>breaks</code>不需要是等距的：</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] (0,5]    (0,5]    (0,5]    (5,10]   (10,100] (10,100]</span></span>
<span><span class="co">#&gt; Levels: (0,5] (5,10] (10,100]</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以选择性地提供你自己的<code>labels</code>。请 注意，<code>labels</code>的数量应该比<code>breaks</code>少一个。</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">x</span>, </span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>, </span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sm"</span>, <span class="st">"md"</span>, <span class="st">"lg"</span>, <span class="st">"xl"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] sm sm sm md lg xl</span></span>
<span><span class="co">#&gt; Levels: sm md lg xl</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>任何超出<code>breaks</code>范围的值都会变成<code>NA</code>：</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">y</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] &lt;NA&gt;   &lt;NA&gt;   (0,5]  (5,10] &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; Levels: (0,5] (5,10] (10,15] (15,20]</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>查看文档以了解其他有用的参数，如<code>right</code>和<code>include.lowest</code>，这些参数控制区间是<code>[a, b)</code>还是&nbsp;<code>(a, b]</code>，以及是否应将最低区间设为<code>[a, b]</code>。</p>
</section><section id="sec-cumulative-and-rolling-aggregates" class="level3" data-number="13.4.7"><h3 data-number="13.4.7" class="anchored" data-anchor-id="sec-cumulative-and-rolling-aggregates">
<span class="header-section-number">13.4.7</span> 累积和滚动聚合</h3>
<p>基础 R 提供了<code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code>,<code><a href="https://rdrr.io/r/base/cumsum.html">cumprod()</a></code>,<code><a href="https://rdrr.io/r/base/cumsum.html">cummin()</a></code>,<code><a href="https://rdrr.io/r/base/cumsum.html">cummax()</a></code>函数，用于计算连续或累积的和、积、最小值和最大值。d plyr 包提供了<code><a href="https://dplyr.tidyverse.org/reference/cumall.html">cummean()</a></code>函数用于计算累积平均值。在 实践中，累积和是最常遇到的：</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  1  3  6 10 15 21 28 36 45 55</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果你需要更复杂的滚动或滑动聚合，可以尝试使用<a href="https://slider.r-lib.org/">slider</a>包。</p>
</section><section id="练习-1" class="level3" data-number="13.4.8"><h3 data-number="13.4.8" class="anchored" data-anchor-id="练习-1">
<span class="header-section-number">13.4.8</span> 练习</h3>
<ol type="1">
<li><p>用文字解释用于生成@fig-prop-cancelled 的每一行代码的作用。</p></li>
<li><p>R提供了什么三角函数？猜 测一些名字并查找文档。这 些函数用度数还是弧度？</p></li>
<li>
<p>目前，<code>dep_time</code>和<code>sched_dep_time</code>看起来很方便，但是难以用于计算，因为它们并不是真正的连续数字。你 可以通过运行下面的代码来看到基本问题：每小时之间都存在间隙。</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">day</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sched_dep_time</span>, y <span class="op">=</span> <span class="va">dep_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>将它们转换为更真实的时间表示（可以是自午夜起的小时数（以小数形式）或分钟数）。</p>
</li>
<li><p>将<code>dep_time</code>和<code>arr_time</code>四舍五入到最近的五分钟。</p></li>
</ol></section></section><section id="通用转换" class="level2" data-number="13.5"><h2 data-number="13.5" class="anchored" data-anchor-id="通用转换">
<span class="header-section-number">13.5</span> 通用转换</h2>
<p>以下部分描述了一些通常与数值向量一起使用的通用转换，但它们也可以应用于所有其他列类型。</p>
<section id="秩ranks" class="level3" data-number="13.5.1"><h3 data-number="13.5.1" class="anchored" data-anchor-id="秩ranks">
<span class="header-section-number">13.5.1</span> 秩（Ranks）</h3>
<p>dplyr 提供了一系列受 SQL 启发的排秩函数，但你应该始终从<code><a href="https://dplyr.tidyverse.org/reference/row_number.html">dplyr::min_rank()</a></code>开始。它 使用了处理并列名次（相持）的标准方法，例如，第1名、第2名、第2名、第4名。</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  1  2  2  4  5 NA</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>请注意，最小的值获得最小的秩；利用<code>desc(x)</code>可以让最大的值获得最小的秩：</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  5  3  3  2  1 NA</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果<code><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank()</a></code>不符合你的需求，请查看它的变体函数<code><a href="https://dplyr.tidyverse.org/reference/row_number.html">dplyr::row_number()</a></code>、<code><a href="https://dplyr.tidyverse.org/reference/row_number.html">dplyr::dense_rank()</a></code>、<code><a href="https://dplyr.tidyverse.org/reference/percent_rank.html">dplyr::percent_rank()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/percent_rank.html">dplyr::cume_dist()</a></code>。查 看文档以获取详细信息。</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    row_number <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    dense_rank <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">dense_rank</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    percent_rank <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/percent_rank.html">percent_rank</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    cume_dist <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/percent_rank.html">cume_dist</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 5</span></span>
<span><span class="co">#&gt;       x row_number dense_rank percent_rank cume_dist</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;      &lt;int&gt;      &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1          1          1         0          0.2</span></span>
<span><span class="co">#&gt; 2     2          2          2         0.25       0.6</span></span>
<span><span class="co">#&gt; 3     2          3          2         0.25       0.6</span></span>
<span><span class="co">#&gt; 4     3          4          3         0.75       0.8</span></span>
<span><span class="co">#&gt; 5     4          5          4         1          1  </span></span>
<span><span class="co">#&gt; 6    NA         NA         NA        NA         NA</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以通过选择适当的<code>ties.method</code>参数来使用 R 的基础函数<code><a href="https://rdrr.io/r/base/rank.html">rank()</a></code>来达到许多相同的结果；你也可能希望通过设置<code>na.last = "keep"</code>将 <code>NA</code>s 值保留为 <code>NA</code>。</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number()</a></code>在 dplyr 的函数内部使用时也可以不带任何参数。在 这种情况下它会给出“当前”行的编号。当 与<code>%%</code>或<code>%/%</code>结合使用时，它可以成为将数据划分为大小相似的组的有用工具：</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    row0 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>    three_groups <span class="op">=</span> <span class="va">row0</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">3</span>,</span>
<span>    three_in_each_group <span class="op">=</span> <span class="va">row0</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">3</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 4</span></span>
<span><span class="co">#&gt;      id  row0 three_groups three_in_each_group</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;               &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     0            0                   0</span></span>
<span><span class="co">#&gt; 2     2     1            1                   0</span></span>
<span><span class="co">#&gt; 3     3     2            2                   0</span></span>
<span><span class="co">#&gt; 4     4     3            0                   1</span></span>
<span><span class="co">#&gt; 5     5     4            1                   1</span></span>
<span><span class="co">#&gt; 6     6     5            2                   1</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="偏移量offsets" class="level3" data-number="13.5.2"><h3 data-number="13.5.2" class="anchored" data-anchor-id="偏移量offsets">
<span class="header-section-number">13.5.2</span> 偏移量（Offsets）</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">dplyr::lead()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">dplyr::lag()</a></code>允许你引用“当前”值之前或之后的值。它 们会返回一个与输入长度相同的向量，并在开始或结束时用 <code>NA</code>s 填充：</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">11</span>, <span class="fl">11</span>, <span class="fl">19</span>, <span class="fl">35</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA  2  5 11 11 19</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  5 11 11 19 35 NA</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>
<p><code>x - lag(x)</code> 给出当前值和前一个值之间的差值。</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA  3  6  0  8 16</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p><code>x == lag(x)</code> 告诉你当前值何时发生改变。</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">==</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]    NA FALSE FALSE  TRUE FALSE FALSE</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul>
<p>你可以通过使用第二个参数<code>n</code>来实现超过一个位置的向前或向后取值。</p>
</section><section id="连续标识符" class="level3" data-number="13.5.3"><h3 data-number="13.5.3" class="anchored" data-anchor-id="连续标识符">
<span class="header-section-number">13.5.3</span> 连续标识符</h3>
<p>有时，每当某个事件发生时你都希望开始一个新组。例 如在查看网站数据时，你通常会希望将事件划分为不同会话（sessions），即当距离上次活动超过 <code>x</code> 分钟时你会开始一个新会话。比 如，想象你有某人访问网站的时间记录：</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">17</span>, <span class="fl">19</span>, <span class="fl">20</span>, <span class="fl">27</span>, <span class="fl">28</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>并且你已经计算了每个事件之间的时间间隔，并判断了是否存在足够大的间隔以符合标准：</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">events</span> <span class="op">&lt;-</span> <span class="va">events</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    diff <span class="op">=</span> <span class="va">time</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">time</span>, default <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    has_gap <span class="op">=</span> <span class="va">diff</span> <span class="op">&gt;=</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">events</span></span>
<span><span class="co">#&gt; # A tibble: 14 × 3</span></span>
<span><span class="co">#&gt;    time  diff has_gap</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;  </span></span>
<span><span class="co">#&gt; 1     0     0 FALSE  </span></span>
<span><span class="co">#&gt; 2     1     1 FALSE  </span></span>
<span><span class="co">#&gt; 3     2     1 FALSE  </span></span>
<span><span class="co">#&gt; 4     3     1 FALSE  </span></span>
<span><span class="co">#&gt; 5     5     2 FALSE  </span></span>
<span><span class="co">#&gt; 6    10     5 TRUE   </span></span>
<span><span class="co">#&gt; # ℹ 8 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>但是，我们如何从逻辑向量转换为可以使用<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>进行分组的东西呢？<code>c</code> <code>umsum()</code>函数（来自 <a href="#sec-cumulative-and-rolling-aggregates" class="quarto-xref"><span>小节 13.4.7</span></a> ）此时就派上了用场，当存在间隔（即<code>has_gap</code>为<code>TRUE</code>）时，它会增加分组编号（来自@sec-numeric-summaries-of-logicals ）：</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">events</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">has_gap</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 × 4</span></span>
<span><span class="co">#&gt;    time  diff has_gap group</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     0     0 FALSE       0</span></span>
<span><span class="co">#&gt; 2     1     1 FALSE       0</span></span>
<span><span class="co">#&gt; 3     2     1 FALSE       0</span></span>
<span><span class="co">#&gt; 4     3     1 FALSE       0</span></span>
<span><span class="co">#&gt; 5     5     2 FALSE       0</span></span>
<span><span class="co">#&gt; 6    10     5 TRUE        1</span></span>
<span><span class="co">#&gt; # ℹ 8 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>创建分组变量的另一种方法是<code><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id()</a></code>，它会在其参数之一发生变化时开始一个新组。例 如，受到<a href="https://stackoverflow.com/questions/27482712">this stackoverflow question</a>的启发，假设你有一个包含许多重复值的数据框：</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">199</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果你想要保留每个重复值<code>x</code>的第一行，你可以使用<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>、<code><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id()</a></code>和<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code>。</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/consecutive_id.html">consecutive_id</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 3</span></span>
<span><span class="co">#&gt; # Groups:   id [7]</span></span>
<span><span class="co">#&gt;   x         y    id</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 a         1     1</span></span>
<span><span class="co">#&gt; 2 b         2     2</span></span>
<span><span class="co">#&gt; 3 c         4     3</span></span>
<span><span class="co">#&gt; 4 d         3     4</span></span>
<span><span class="co">#&gt; 5 e         9     5</span></span>
<span><span class="co">#&gt; 6 a         4     6</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="练习-2" class="level3" data-number="13.5.4"><h3 data-number="13.5.4" class="anchored" data-anchor-id="练习-2">
<span class="header-section-number">13.5.4</span> 练习</h3>
<ol type="1">
<li><p>使用排秩函数找出延误时间最长的10个航班。如 果出现并列的情况，你打算如何处理？请 仔细阅读<code><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank()</a></code>函数的文档。</p></li>
<li><p>哪架飞机（<code>tailnum</code>）的准时记录最差？</p></li>
<li><p>如果你想尽可能避免延误，你应该在一天中的哪个时间段飞行？</p></li>
<li><p><code>flights |&gt; group_by(dest) |&gt; filter(row_number() &lt; 4)</code>这段代码做了什么？<code>f</code> <code>lights |&gt; group_by(dest) |&gt; filter(row_number(dep_delay) &lt; 4)</code>这段代码又做了什么？</p></li>
<li><p>对于每个目的地，计算延误的总分钟数；对于每个航班，计算其目的地延误总时间中所占的比例。</p></li>
<li>
<p>延误通常是时间相关的：即使导致初始延误的问题已经解决，后续的航班仍然会延误以允许前面的航班起飞。使 用<code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag()</a></code>函数，探索某小时的平均航班延误与前一小时的平均延误之间的关系。</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hour <span class="op">=</span> <span class="va">dep_time</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">100</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    dep_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dep_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li><p>查看每个目的地，你能找到那些可疑的快速航班（即可能存在数据录入错误的航班）吗？计 算某航班的空中飞行时间与该目的地最短飞行时间的相对值。哪 些航班在空中延误最严重？</p></li>
<li><p>找出至少由两家航空公司运营的所有目的地。使 用这些目的地，根据同一目的地的表现，对航空公司进行相对排名。</p></li>
</ol></section></section><section id="数值汇总" class="level2" data-number="13.6"><h2 data-number="13.6" class="anchored" data-anchor-id="数值汇总">
<span class="header-section-number">13.6</span> 数值汇总</h2>
<p>仅使用我们已经介绍过的<code>counts</code>、<code>means</code>和<code>sums</code>就可以让你走得很远，但R提供了许多其他有用的汇总函数。以 下是可能会有用的一些函数。</p>
<section id="中心" class="level3" data-number="13.6.1"><h3 data-number="13.6.1" class="anchored" data-anchor-id="中心">
<span class="header-section-number">13.6.1</span> 中心</h3>
<p>到目前为止，我们主要使用<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>来汇总数值向量的中心。正 如在@sec-sample-size 看到的，由于均数是总和除以总数得到的，因此即使对几个异常高或异常低的值它也很敏感。一 种替代方法是使用<code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>，它会找到一个位于向量“中间”的值，即50%的值高于它，50%的值低于它。根 据你感兴趣的变量的分布形状，选取均数或者中位数作为合适的中心度量标准。例 如对于对称分布我们通常报告均数，而对于偏态分布则报告中位数。</p>
<p><a href="#fig-mean-vs-median" class="quarto-xref">图&nbsp;<span>13.2</span></a> 比较了每个目的地的起飞延误均数与中位数（以分钟为单位）。延 误中位数总是小于延误均数，因为航班有时会延误数小时，但永远不会提前数小时起飞。</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dep_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">dep_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean</span>, y <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"white"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-mean-vs-median" class="quarto-figure quarto-figure-center quarto-float anchored" alt="All points fall below a 45° line, meaning that the median delay is always less than the mean delay. Most points are clustered in a dense region of mean [0, 20] and median [-5, 5]. As the mean delay increases, the spread of the median also increases. There are two outlying points with mean ~60, median ~30, and mean ~85, median ~55.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-mean-vs-median-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="numbers_files/figure-html/fig-mean-vs-median-1.png" class="img-fluid figure-img" alt="All points fall below a 45° line, meaning that the median delay is always less than the mean delay. Most points are clustered in a dense region of mean [0, 20] and median [-5, 5]. As the mean delay increases, the spread of the median also increases. There are two outlying points with mean ~60, median ~30, and mean ~85, median ~55." width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mean-vs-median-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.2: A scatterplot showing the differences of summarizing daily departure delay with median instead of mean.
</figcaption></figure>
</div>
</div>
</div>
<p>你可能还想知道众数（mode），也就是最常见的值。这 是一种仅在非常简单的情况下才有效的汇总统计量（这就是为什么你可能在高中学过它），但它在许多真实数据集上并不适用。如 果数据是离散的，可能存在多个最常见的值，而如果数据是连续的，则可能没有最常见的值，因为每个值都略有不同。由 于这些原因，统计学家往往不使用众数，并且在R的基础包中也没有包含计算众数<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>的函数。</p>
</section><section id="sec-min-max-summary" class="level3" data-number="13.6.2"><h3 data-number="13.6.2" class="anchored" data-anchor-id="sec-min-max-summary">
<span class="header-section-number">13.6.2</span> 最小值、最大值和分位数</h3>
<p>如果你对中心位置以外的其他位置感兴趣怎么办？<code>m</code> <code>in()</code>和<code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>会给你最大值和最小值。另 一个强大的工具是<code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code>，它是中位数的泛化：<code>quantile(x, 0.25)</code>会找到大于 25% 的<code>x</code>的值，<code>quantile(x, 0.5)</code>相当于中位数，而<code>quantile(x, 0.95)</code>会找到大于 95% 的<code>x</code>的值。</p>
<p>对于<code>flights</code>数据，你可能想查看延误的 95% 分位数而不是最大值，因为它会忽略延误最严重的 5% 航班，这部分航班可能非常极端。</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dep_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q95 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">dep_delay</span>, <span class="fl">0.95</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 365 × 5</span></span>
<span><span class="co">#&gt;    year month   day   max   q95</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1   853  70.1</span></span>
<span><span class="co">#&gt; 2  2013     1     2   379  85  </span></span>
<span><span class="co">#&gt; 3  2013     1     3   291  68  </span></span>
<span><span class="co">#&gt; 4  2013     1     4   288  60  </span></span>
<span><span class="co">#&gt; 5  2013     1     5   327  41  </span></span>
<span><span class="co">#&gt; 6  2013     1     6   202  51  </span></span>
<span><span class="co">#&gt; # ℹ 359 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="离散性spread" class="level3" data-number="13.6.3"><h3 data-number="13.6.3" class="anchored" data-anchor-id="离散性spread">
<span class="header-section-number">13.6.3</span> 离散性（Spread）</h3>
<p>有时你并不是那么关心大部分数据所在的位置，而是关心它的离散程度。两 个常用的汇总统计量是标准差<code>sd(x)</code>和四分位距<code><a href="https://rdrr.io/r/stats/IQR.html">IQR()</a></code>。我 们在这里不会解释<code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>，因为你可能已经很熟悉了，但<code><a href="https://rdrr.io/r/stats/IQR.html">IQR()</a></code>可能比较新颖，它等于<code>quantile(x, 0.75) - quantile(x, 0.25)</code>，给出了包含中间 50% 数据的范围。</p>
<p>我们可以利用这个方法来揭示<code>flights</code>数据中的一个小异常。你 可能会认为，由于机场总是在固定的位置，所以起点和终点之间距离的离散性应该是零。但 是下面的代码揭示了机场 <a href="https://en.wikipedia.org/wiki/Eagle_County_Regional_Airport">EGE</a> 的一个数据异常：</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">dest</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    distance_iqr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span>, </span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">distance_iqr</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;   origin dest  distance_iqr     n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 EWR    EGE              1   110</span></span>
<span><span class="co">#&gt; 2 JFK    EGE              1   103</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="分布" class="level3" data-number="13.6.4"><h3 data-number="13.6.4" class="anchored" data-anchor-id="分布">
<span class="header-section-number">13.6.4</span> 分布</h3>
<p>值得记住的是，上述所有描述的汇总统计量都是将分布简化为单个数字的一种方式。这 意味着它们本质上是简化的，如果你选择了错误的汇总方式，很容易忽略各组之间的重要差异。因 此，在确定汇总统计量之前，先对数据进行可视化始终是个好主意。</p>
<p><a href="#fig-flights-dist" class="quarto-xref">图&nbsp;<span>13.3</span></a> 显示了出发延误的整体分布。这 个分布是如此偏斜，以至于我们必须放大才能看到大部分数据。这 表明均数可能不是一个好的汇总方式，我们可能更喜欢使用中位数。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-flights-dist" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Two histograms of `dep_delay`. On the left, it's very hard to see any pattern except that there's a very large spike around zero, the bars rapidly decay in height, and for most of the plot, you can't see any bars because they are too short to see. On the right, where we've discarded delays of greater than two hours, we can see that the spike occurs slightly below zero (i.e. most flights leave a couple of minutes early), but there's still a very steep decay after that. ">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-flights-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="numbers_files/figure-html/fig-flights-dist-1.png" class="img-fluid figure-img" alt="Two histograms of `dep_delay`. On the left, it's very hard to see any pattern except that there's a very large spike around zero, the bars rapidly decay in height, and for most of the plot, you can't see any bars because they are too short to see. On the right, where we've discarded delays of greater than two hours, we can see that the spike occurs slightly below zero (i.e. most flights leave a couple of minutes early), but there's still a very steep decay after that. " width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-flights-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;13.3: (Left) The histogram of the full data is extremely skewed making it hard to get any details. (Right) Zooming into delays of less than two hours makes it possible to see what’s happening with the bulk of the observations.
</figcaption></figure>
</div>
</div>
</div>
<p>同样，检查子组的分布是否与整体相似也是一个好主意。在 下面的图中，<code>dep_delay</code>的365个频数多边形图（frequency polygons）被叠加在一起，每天一个。这 些分布似乎遵循一个共同的模式，这表明每天使用相同的汇总方式是合适的。</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dep_delay</span> <span class="op">&lt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dep_delay</span>, group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">day</span>, <span class="va">month</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="numbers_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" alt="The distribution of `dep_delay` is highly right skewed with a strong peak slightly less than 0. The 365 frequency polygons are mostly overlapping forming a thick black band." width="576"></p>
</figure>
</div>
</div>
</div>
<p>不要害怕探讨针对你正在处理的数据自定义的汇总方法。在 这种情况下，这可能意味着分别汇总提前起飞的航班和晚起飞的航班的分布，或者鉴于这些值严重偏斜，你可能还需尝试进行对数转换。最 后，不要忘记在@sec-sample-size 中学到的内容：每当创建数值汇总时，最好包括每个组的观测数。</p>
</section><section id="位置" class="level3" data-number="13.6.5"><h3 data-number="13.6.5" class="anchored" data-anchor-id="位置">
<span class="header-section-number">13.6.5</span> 位置</h3>
<p>对于数值向量，还有最后一种类型的汇总统计量非常有用，它也适用于其他类型的值：提取特定位置的值：<code>first(x)</code>、<code>last(x)</code> 和 <code>nth(x, n)</code>。</p>
<p>例如，我们可以找到每天第一次、第五次和最后一次的出发时间：</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    first_dep <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">first</a></span><span class="op">(</span><span class="va">dep_time</span>, na_rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    fifth_dep <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">nth</a></span><span class="op">(</span><span class="va">dep_time</span>, <span class="fl">5</span>, na_rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    last_dep <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">dep_time</span>, na_rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'year', 'month'. You can override using</span></span>
<span><span class="co">#&gt; the `.groups` argument.</span></span>
<span><span class="co">#&gt; # A tibble: 365 × 6</span></span>
<span><span class="co">#&gt; # Groups:   year, month [12]</span></span>
<span><span class="co">#&gt;    year month   day first_dep fifth_dep last_dep</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1       517       554     2356</span></span>
<span><span class="co">#&gt; 2  2013     1     2        42       535     2354</span></span>
<span><span class="co">#&gt; 3  2013     1     3        32       520     2349</span></span>
<span><span class="co">#&gt; 4  2013     1     4        25       531     2358</span></span>
<span><span class="co">#&gt; 5  2013     1     5        14       534     2357</span></span>
<span><span class="co">#&gt; 6  2013     1     6        16       555     2355</span></span>
<span><span class="co">#&gt; # ℹ 359 more rows</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(注意：因为dplyr函数使用<code>_</code>来分隔函数名和参数名的组件，所以这些函数使用<code>na_rm</code>而不是<code>na.rm</code>）</p>
<p>如果你熟悉<code>[</code>操作符，我们将在@sec-subset-many 中再次讨论它，你可能会想是否需要这些函数。有 三个原因：默认参数允许你在指定的位置不存在时提供一个默认值，<code>order_by</code>参数允许你局部覆盖行的顺序，而<code>na_rm</code>参数允许你删除缺失值。</p>
<p>按位置提取值是对按秩筛选的补充。筛 选操作会返回所有变量，每个观测都在单独的一行中：</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">min_rank</a></span><span class="op">(</span><span class="va">sched_dep_time</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">r</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1,195 × 20</span></span>
<span><span class="co">#&gt; # Groups:   year, month, day [365]</span></span>
<span><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1      517            515         2      830            819</span></span>
<span><span class="co">#&gt; 2  2013     1     1     2353           2359        -6      425            445</span></span>
<span><span class="co">#&gt; 3  2013     1     1     2353           2359        -6      418            442</span></span>
<span><span class="co">#&gt; 4  2013     1     1     2356           2359        -3      425            437</span></span>
<span><span class="co">#&gt; 5  2013     1     2       42           2359        43      518            442</span></span>
<span><span class="co">#&gt; 6  2013     1     2      458            500        -2      703            650</span></span>
<span><span class="co">#&gt; # ℹ 1,189 more rows</span></span>
<span><span class="co">#&gt; # ℹ 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, …</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="利用-mutate" class="level3" data-number="13.6.6"><h3 data-number="13.6.6" class="anchored" data-anchor-id="利用-mutate">
<span class="header-section-number">13.6.6</span> 利用 <code>mutate()</code>
</h3>
<p>顾名思义，汇总函数通常与<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>一起使用。但 是，因为我们在@sec-recycling 中讨论的循环规则，它们也可以与<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>一起使用，特别是当你想进行某种分组标准化时。例 如：</p>
<ul>
<li>
<code>x / sum(x)</code> 计算了<code>x</code>中每个元素占总和的比例；</li>
<li>
<code>(x - mean(x)) / sd(x)</code> 计算Z-score（将<code>x</code>标准化为均数为0，标准差为1）；</li>
<li>
<code>(x - min(x)) / (max(x) - min(x))</code> 将<code>x</code>标准化到范围[0, 1]；</li>
<li>
<code>x / first(x)</code> 基于第一个观测值计算一个指数。</li>
</ul></section><section id="练习-3" class="level3" data-number="13.6.7"><h3 data-number="13.6.7" class="anchored" data-anchor-id="练习-3">
<span class="header-section-number">13.6.7</span> 练习</h3>
<ol type="1">
<li><p>头脑风暴至少5种不同的方法来评估一组航班的典型延误特性。什 么时候用<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>？什 么时候用<code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>？什 么情况下你可能想使用其他方法？你 应该使用到达延误还是起飞延误？为 什么你可能想使用来自<code>planes</code>的数据？</p></li>
<li><p>哪些目的地的航速变化最大？</p></li>
<li><p>创建一个图来进一步探索EGE的冒险经历。 你能找到机场变换位置的任何证据吗？你 能找到可解释这种差异的另一个变量吗？</p></li>
</ol></section></section><section id="小结" class="level2" data-number="13.7"><h2 data-number="13.7" class="anchored" data-anchor-id="小结">
<span class="header-section-number">13.7</span> 小结</h2>
<p>你已经熟悉了许多用于数字处理的工具，在阅读本章之后也知道了如何在R中使用它们。你 还学习了一些有用的通用转换方法，这些方法通常（但不仅限于）应用于数字向量，如秩和偏移量。最 后，通过一些数字汇总进行了实践，并讨论了几个你应该考虑的统计学挑战。</p>
<p>在接下来的两章中，我们将使用<code>stringr</code>包深入研究字符串的处理。字 符串是一个很大的主题，因此它们被分为两章，一章关于字符串的基础知识，另一章关于正则表达式。</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p><code>ggplot2</code>提供了一些辅助函数来处理<code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_interval()</a></code>,<code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_number()</a></code>和<code><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_width()</a></code>中的常见情况。虽 然<code>ggplot2</code>是这些函数存放的一个稍显奇怪的地方，但它们作为直方图计算的一部分非常有用，并且在 tidyverse 的其他部分出现之前就已经被编写出来了。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><code><a href="https://rdrr.io/r/base/mode.html">mode()</a></code> 函数做的是完全不同的事情!<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r4ds\.hadley\.nz\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./logicals.html" class="pagination-link" aria-label="逻辑向量">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">逻辑向量</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./strings.html" class="pagination-link" aria-label="字符串">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">字符串</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>R数据科学 (第二版) 由 Hadley Wickham等人编写</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/qbgaoo/r4ds-chinese/edit/main/numbers.qmd" class="toc-action"><i class="bi bi-github"></i>编辑该页面</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>此书利用 <a href="https://quarto.org/">Quarto</a>制作</p>
</div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>